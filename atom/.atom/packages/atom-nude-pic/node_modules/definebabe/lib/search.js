import request from 'request-promise';
import cheerio from 'cheerio';

const BASE_URL = 'http://www.definebabe.com';

export default (query) => {
  const OPTIONS  = {
    uri: `${BASE_URL}/search?words=${query}`,
    followAllRedirects: true,
    transform: function (body) {
      return cheerio.load(body);
    }
  };
  return request(OPTIONS)
    .then($ => {
      return Promise.resolve({
        id: $('.profile-menu a').first().attr('href').substring(8, 12),
        name: $('div.info h1').text(),
        slug: $('div.info h1').text().replace(' ', '-').toLowerCase(),
        country: $('div.info p:contains("Country") b').text(),
        state: $('div.info p:contains("State") b').text(),
        rating: $('.rating .desc span').text()
      });
    })
    .catch(err => {
      return Promise.reject(err);
    });
}