import request from 'request-promise';
import cheerio from 'cheerio';

const BASE_URL = 'http://www.definebabe.com';

export default (id, slug) => {
  const OPTIONS  = {
    uri: `${BASE_URL}/models/${id}/${slug}/galleries`,
    followAllRedirects: true,
    transform: function (body) {
      return cheerio.load(body);
    }
  };
  return request(OPTIONS)
    .then($ => {
      let galleries = $('.galleries-list .thumb');
      let galleriesArray = [];
      galleries.map((i, item) => {
        galleriesArray.push({
          id: $(item).find('a').attr('href').substring(9, 13),
          title: $(item).find('a').attr('title'),
          total_pictures: $(item).find('small').text().match(/\d+/g)[0],
          thumb: $(item).find('.panorama img').attr('src')
        });
      })
      return Promise.resolve(galleriesArray);
  });
}